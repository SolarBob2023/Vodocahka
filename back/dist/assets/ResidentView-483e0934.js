import{_ as k,d as R,g as w,h as p,r as h,i as _,o as r,c as n,a,e as l,b as i,j as D,t as o,w as c,v as m,n as g,F as f,k as v,f as V}from"./index-5758cdee.js";import{o as P}from"./vue-datepicker-be1eeb2c.js";import{d as y}from"./main-f1c8270c.js";const C=R({name:"ResidentView",components:{VueDatePicker:P},data(){return{residents:{data:null,links:null},resident:{fio:null,area:null,start_date:new Date},errors:{fio:null,area:null,start_date:null,message:null},addingRate:!1}},computed:{minPeriod(){const e=new Date(2022,1,1),t=new Date(new Date().getFullYear(),new Date().getMonth()-1,1);return y(t,e)+2},period(){const e=new Date(2022,1,1),t=new Date(this.resident.start_date.getFullYear(),this.resident.start_date.getMonth(),1);return y(t,e)+2},isValidPeriod(){return this.period>=this.minPeriod}},mounted(){this.getResidents()},methods:{...w(V,{storeError:"storeError"}),changeAddingRate(){this.addingRate=!this.addingRate},clearInputs(){this.resident.fio=null,this.resident.area=null,this.resident.start_date=new Date,this.errors.fio=null,this.errors.area=null,this.errors.start_date=null,this.errors.message=null},async getResidents(e=1){try{const t=await p.get(`/api/admin/residents?page=${e}`);t.status===200&&t.data&&(this.residents.data=t.data.data,this.residents.links=t.data.meta.links,this.residents.links.forEach(d=>{if(d.url){const u=new URL(d.url);d.page=u.searchParams.get("page")}else d.page=null}))}catch(t){this.storeError(t),h.push({name:"error"})}},async addResident(){try{(await p.post("/api/admin/residents",{fio:this.resident.fio,area:this.resident.area,start_date:this.resident.start_date})).status===201&&(await this.getResidents(),this.clearInputs(),this.changeAddingRate())}catch(e){e.response&&e.response.status===422?this.errors=e.response.data.errors:(this.clearInputs(),this.changeAddingRate(),this.storeError(e),h.push({name:"error"}))}}}}),A={class:"row"},E={class:"row d-flex justify-content-between"},M=a("h2",{class:"col-2"},"Список",-1),$={key:0},F=a("div",{class:"form-label mt-2"},"Дата подключения",-1),I={key:0,class:"text-danger mt-2"},L={key:1,class:"text-danger mt-2"},U=a("div",{class:"form-label mt-2"},"Площадь",-1),j={key:2,class:"text-danger mt-2"},B=a("div",{class:"form-label mt-2"},"ФИО",-1),N={key:3,class:"text-danger mt-2"},T={key:4,class:"text-danger mt-2"},H={key:1},S={class:"table"},Y=a("thead",null,[a("tr",null,[a("th",{scope:"col"},"ФИО"),a("th",{scope:"col"},"Площадь"),a("th",{scope:"col"},"Дата подключения")])],-1),z={"aria-label":"Page navigation example"},X={class:"pagination justify-content-center"},q=["onClick","innerHTML"];function G(e,t,d,u,J,K){const b=_("VueDatePicker");return r(),n("div",A,[a("div",E,[M,e.addingRate?i("",!0):(r(),n("button",{key:0,onClick:t[0]||(t[0]=l((...s)=>e.changeAddingRate&&e.changeAddingRate(...s),["prevent"])),class:"btn btn-primary col-2"},"+")),e.addingRate?(r(),n("button",{key:1,onClick:t[1]||(t[1]=l((...s)=>e.changeAddingRate&&e.changeAddingRate(...s),["prevent"])),class:"btn btn-primary col-2"},"X")):i("",!0)]),e.addingRate?(r(),n("div",$,[F,D(b,{class:"mt-2",modelValue:e.resident.start_date,"onUpdate:modelValue":t[2]||(t[2]=s=>e.resident.start_date=s),"auto-apply":"","text-input":""},null,8,["modelValue"]),e.errors.start_date?(r(),n("div",I,o(e.errors.start_date[0]),1)):i("",!0),e.isValidPeriod?i("",!0):(r(),n("div",L,"Нельзя добавить дачника в прошедший период")),U,c(a("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=s=>e.resident.area=s),class:"form-control mt-2",step:"0.01",placeholder:"Площадь"},null,512),[[m,e.resident.area]]),e.errors.area?(r(),n("div",j,o(e.errors.area[0]),1)):i("",!0),B,c(a("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=s=>e.resident.fio=s),class:"form-control mt-2",placeholder:"ФИО"},null,512),[[m,e.resident.fio]]),e.errors.fio?(r(),n("div",N,o(e.errors.fio[0]),1)):i("",!0),e.errors.message?(r(),n("div",T,o(e.errors.message[0]),1)):i("",!0),a("input",{type:"submit",onClick:t[5]||(t[5]=l((...s)=>e.addResident&&e.addResident(...s),["prevent"])),class:g("form-control btn btn-primary mt-2 "+(e.isValidPeriod?"":"disabled")),value:"Добавить дачника"},null,2)])):i("",!0),e.residents.data&&e.residents.data.length>0?(r(),n("div",H,[a("table",S,[Y,a("tbody",null,[(r(!0),n(f,null,v(e.residents.data,s=>(r(),n("tr",{key:s.id},[a("th",null,o(s.fio),1),a("td",null,o(s.area),1),a("td",null,o(s.start_date),1)]))),128))])]),a("nav",z,[a("ul",X,[(r(!0),n(f,null,v(e.residents.links,s=>(r(),n("li",{key:s.label,class:g("page-item "+(s.active?"active ":"")+(s.url?"":"disabled"))},[a("a",{onClick:l(O=>e.getResidents(s.page),["prevent"]),class:"page-link",href:"#",innerHTML:s.label},null,8,q)],2))),128))])])])):i("",!0)])}const x=k(C,[["render",G]]);export{x as default};
