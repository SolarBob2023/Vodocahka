import{_ as m,d as v,g as f,h as c,r as p,o as r,c as o,a as s,e as d,b as n,w as y,v as R,t as i,F as h,k as g,f as b,n as k}from"./index-db0557d3.js";import{d as w}from"./main-f1c8270c.js";const C=v({name:"RecordView",data(){return{rates:{data:null,links:null},errors:{volume:null,period:null},volume:null,addingRate:!1}},computed:{period(){const e=new Date(2022,1,1),a=new Date(new Date().getFullYear(),new Date().getMonth()-1,1);return w(a,e)+2}},mounted(){this.getRecords()},methods:{...f(b,{storeError:"storeError"}),changeAddingRate(){this.addingRate=!this.addingRate},async getRecords(e=1){try{const a=await c.get(`/api/admin/records?page=${e}`);a.status===200&&a.data&&(this.rates.data=a.data.data,this.rates.links=a.data.meta.links,this.rates.links.forEach(l=>{if(l.url){const u=new URL(l.url);l.page=u.searchParams.get("page")}else l.page=null}))}catch(a){this.storeError(a),p.push({name:"error"})}},async addRate(){try{const e=await c.post("/api/admin/records",{volume:this.volume,period:this.period});(e.status===200||e.status===201)&&(await this.getRecords(),this.errors.period=null,this.errors.volume=null,this.changeAddingRate())}catch(e){e.response&&e.response.status===422?this.errors=e.response.data.errors:(this.storeError(e),p.push({name:"error"}))}}}}),D={class:"row"},A={class:"row d-flex justify-content-between"},E=s("h2",{class:"col-2"},"Список",-1),_={key:0},M=s("div",{class:"form-label mt-2"},"Показания счётчика",-1),$={key:0,class:"text-danger mt-2"},V={key:1,class:"text-danger mt-2"},L={key:1},B={class:"table"},F=s("thead",null,[s("tr",null,[s("th",{scope:"col"},"Год"),s("th",{scope:"col"},"Месяц"),s("th",{scope:"col"},"Объём")])],-1),T={"aria-label":"Page navigation example"},j={class:"pagination justify-content-center"},H=["onClick","innerHTML"];function N(e,a,l,u,P,S){return r(),o("div",D,[s("div",A,[E,e.addingRate?n("",!0):(r(),o("button",{key:0,onClick:a[0]||(a[0]=d((...t)=>e.changeAddingRate&&e.changeAddingRate(...t),["prevent"])),class:"btn btn-primary col-2"},"+")),e.addingRate?(r(),o("button",{key:1,onClick:a[1]||(a[1]=d((...t)=>e.changeAddingRate&&e.changeAddingRate(...t),["prevent"])),class:"btn btn-primary col-2"},"X")):n("",!0)]),e.addingRate?(r(),o("div",_,[M,y(s("input",{type:"number","onUpdate:modelValue":a[2]||(a[2]=t=>e.volume=t),class:"form-control mt-2",step:"0.01",placeholder:"Цена"},null,512),[[R,e.volume]]),e.errors.volume?(r(),o("div",$,i(e.errors.volume[0]),1)):n("",!0),e.errors.period?(r(),o("div",V,i(e.errors.period[0]),1)):n("",!0),s("input",{type:"submit",onClick:a[3]||(a[3]=d((...t)=>e.addRate&&e.addRate(...t),["prevent"])),class:"form-control btn btn-primary mt-2",value:"Добавить показания"})])):n("",!0),e.rates.data&&e.rates.data.length>0?(r(),o("div",L,[s("table",B,[F,s("tbody",null,[(r(!0),o(h,null,g(e.rates.data,t=>(r(),o("tr",{key:t.id},[s("th",null,i(t.year),1),s("td",null,i(t.month),1),s("td",null,i(t.volume),1)]))),128))])]),s("nav",T,[s("ul",j,[(r(!0),o(h,null,g(e.rates.links,t=>(r(),o("li",{key:t.label,class:k("page-item "+(t.active?"active ":"")+(t.url?"":"disabled"))},[s("a",{onClick:d(U=>e.getRecords(t.page),["prevent"]),class:"page-link",href:"#",innerHTML:t.label},null,8,H)],2))),128))])])])):n("",!0)])}const X=m(C,[["render",N]]);export{X as default};
